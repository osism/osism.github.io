"use strict";(self.webpackChunkosism=self.webpackChunkosism||[]).push([[5182],{4160:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>a,toc:()=>d});var r=t(5893),s=t(3905);const i={sidebar_label:"Network"},o="Network",a={id:"guides/configuration-guide/commons/network",title:"Network",description:"The osism.commons.network role is used for the netwok configuration.",source:"@site/docs/guides/configuration-guide/commons/network.md",sourceDirName:"guides/configuration-guide/commons",slug:"/guides/configuration-guide/commons/network",permalink:"/docs/guides/configuration-guide/commons/network",draft:!1,unlisted:!1,editUrl:"https://github.com/osism/osism.github.io/tree/main/docs/guides/configuration-guide/commons/network.md",tags:[],version:"current",frontMatter:{sidebar_label:"Network"},sidebar:"tutorialSidebar",previous:{title:"Commons",permalink:"/docs/guides/configuration-guide/commons/"},next:{title:"Packages",permalink:"/docs/guides/configuration-guide/commons/packages"}},l={},d=[{value:"Netplan",id:"netplan",level:2},{value:"Example",id:"example",level:3},{value:"Dispatcher scripts",id:"dispatcher-scripts",level:3},{value:"Dummy interfaces",id:"dummy-interfaces",level:3},{value:"<code>/etc/interfaces</code>",id:"etcinterfaces",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,s.ah)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"network",children:"Network"}),"\n",(0,r.jsxs)(n.p,{children:["The osism.commons.network role is used for the netwok configuration.\n",(0,r.jsx)(n.a,{href:"https://netplan.io",children:"Netplan"})," is used by default. It is also possible to use the\nold ",(0,r.jsx)(n.code,{children:"/etc/interfaces"})," file."]}),"\n",(0,r.jsx)(n.h2,{id:"netplan",children:"Netplan"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",metastring:'title="Since OSISM 6.1.0, the default network type is a netplan and no longer needs to be set explicitly"',children:"network_type: netplan\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The configuration is written to ",(0,r.jsx)(n.code,{children:"/etc/netplan/01-osism.yaml"})," by default. Can be changed\nvia the ",(0,r.jsx)(n.code,{children:"network_netplan_path"})," and ",(0,r.jsx)(n.code,{children:"network_netplan_file"})," parameters. The file permissions\nare ",(0,r.jsx)(n.code,{children:"0600"})," by default (cane be changed via the ",(0,r.jsx)(n.code,{children:"network_netplan_permissions"})," parameter).\nBy default, all other files in ",(0,r.jsx)(n.code,{children:"/etc/netplan"})," are removed. If you do not want this, you\ncan set ",(0,r.jsx)(n.code,{children:"network_netplan_remove_unmanaged_files"})," to ",(0,r.jsx)(n.code,{children:"false"}),". It is also possible to explicitly\nlist individual files that should not be deleted in ",(0,r.jsx)(n.code,{children:"network_netplan_managed_files_extra"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["An existing ",(0,r.jsx)(n.code,{children:"/etc/intefaces"})," file is replaced with a placeholder file. It is not possible\nto use ",(0,r.jsx)(n.code,{children:"/etc/interfaces"})," and Netplan in parallel."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",metastring:'title="This template is used as the base for the configuration"',children:"# This file describes the network interfaces available on your system\n# For more information, see netplan(5).\n---\nnetwork:\n  version: {{ network_version }}\n  renderer: {{ network_renderer }}\n\n  bonds:\n    {{ network_bonds|to_nice_yaml(indent=4)|indent(4) }}\n\n  bridges:\n    {{ network_bridges|to_nice_yaml(indent=4)|indent(4) }}\n\n  ethernets:\n    {{ network_ethernets|to_nice_yaml(indent=4)|indent(4) }}\n\n  tunnels:\n    {{ network_tunnels|to_nice_yaml(indent=4)|indent(4) }}\n\n  vlans:\n    {{ network_vlans|to_nice_yaml(indent=4)|indent(4) }}\n"})}),"\n",(0,r.jsx)(n.p,{children:"The parameters listed in the following table can be used in the template."}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:(0,r.jsx)(n.strong,{children:"Parameter"})}),(0,r.jsx)(n.th,{children:(0,r.jsx)(n.strong,{children:"Default"})}),(0,r.jsx)(n.th,{children:(0,r.jsx)(n.strong,{children:"Description"})})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"network_version"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"2"})}),(0,r.jsx)(n.td,{children:"Defines what version of the configuration format is used. The only value supported at the moment is 2."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"network_renderer"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"networkd"})}),(0,r.jsx)(n.td,{children:"Defines what network configuration tool will be used to set up your configuration. Valid values are networkd and NetworkManager."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"network_bonds"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"{}"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.a,{href:"https://netplan.readthedocs.io/en/stable/netplan-yaml/#properties-for-device-type-bonds",children:"https://netplan.readthedocs.io/en/stable/netplan-yaml/#properties-for-device-type-bonds"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"network_bridges"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"{}"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.a,{href:"https://netplan.readthedocs.io/en/stable/netplan-yaml/#properties-for-device-type-bridges",children:"https://netplan.readthedocs.io/en/stable/netplan-yaml/#properties-for-device-type-bridges"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"network_ethernets"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"{}"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.a,{href:"https://netplan.readthedocs.io/en/stable/netplan-yaml/#properties-for-device-type-ethernets",children:"https://netplan.readthedocs.io/en/stable/netplan-yaml/#properties-for-device-type-ethernets"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"network_tunnels"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"{}"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.a,{href:"https://netplan.readthedocs.io/en/stable/netplan-yaml/#properties-for-device-type-tunnels",children:"https://netplan.readthedocs.io/en/stable/netplan-yaml/#properties-for-device-type-tunnels"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"network_vlans"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"{}"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.a,{href:"https://netplan.readthedocs.io/en/stable/netplan-yaml/#properties-for-device-type-vlans",children:"https://netplan.readthedocs.io/en/stable/netplan-yaml/#properties-for-device-type-vlans"})})]})]})]}),"\n",(0,r.jsxs)(n.p,{children:["Changes to the configuration are currently not applied utomatically. This is done on\npurpose to enable a manual check in advance. Changes to the network configuration can\nbe applied either by rebooting or by executing ",(0,r.jsx)(n.code,{children:"netplan apply"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"$ osism console --type clush all\nEnter 'quit' to leave this interactive mode\nWorking with nodes: testbed-manager.testbed.osism.xyz,testbed-node-[0-2].testbed.osism.xyz\nclush> sudo netplan apply\n"})}),"\n",(0,r.jsx)(n.h3,{id:"example",children:"Example"}),"\n",(0,r.jsxs)(n.p,{children:["The Netplan documentation contains a large number of example configurations. The following\nexample shows the use of ",(0,r.jsx)(n.a,{href:"https://netplan.readthedocs.io/en/stable/examples/#how-to-create-vlans",children:"How to create VLANs"})," with the osism.commons.network role."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'network_ethernets:\n  mainif:\n    match:\n      macaddress: "de:ad:be:ef:ca:fe"\n    set-name: mainif\n    addresses: [ "10.3.0.5/23" ]\n    nameservers:\n      addresses: [ "8.8.8.8", "8.8.4.4" ]\n      search: [ example.com ]\n    routes:\n      - to: default\n        via: 10.3.0.1\n\nnetwork_vlans:\n  vlan15:\n    id: 15\n    link: mainif\n    addresses: [ "10.3.99.5/24" ]\n  vlan10:\n    id: 10\n    link: mainif\n    addresses: [ "10.3.98.5/24" ]\n    nameservers:\n      addresses: [ "127.0.0.1" ]\n      search: [ domain1.example.com, domain2.example.com ]\n'})}),"\n",(0,r.jsx)(n.h3,{id:"dispatcher-scripts",children:"Dispatcher scripts"}),"\n",(0,r.jsx)(n.h3,{id:"dummy-interfaces",children:"Dummy interfaces"}),"\n",(0,r.jsxs)(n.p,{children:["Dummy devices are created with the help of\n",(0,r.jsx)(n.a,{href:"https://www.freedesktop.org/software/systemd/man/latest/systemd.netdev.html",children:"systemd.netdev"}),"\nand can then be used as a normal netowrk device in the Netplan configuration."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"network_dummy_interfaces:\n  - dummy0\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The MTU is set to 9000 by default and can be set via ",(0,r.jsx)(n.code,{children:"network_dummy_interface_mtu"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"etcinterfaces",children:(0,r.jsx)(n.code,{children:"/etc/interfaces"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",metastring:'title="If /etc/interfaces is to be used, the network_type must be explicitly set in environments/configuration.yml"',children:"network_type: interfaces\n"})})]})}function h(e={}){const{wrapper:n}={...(0,s.ah)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},3905:(e,n,t)=>{t.d(n,{ah:()=>d});var r=t(7294);function s(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){s(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function a(e,n){if(null==e)return{};var t,r,s=function(e,n){if(null==e)return{};var t,r,s={},i=Object.keys(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||(s[t]=e[t]);return s}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(s[t]=e[t])}return s}var l=r.createContext({}),d=function(e){var n=r.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},c={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},h=r.forwardRef((function(e,n){var t=e.components,s=e.mdxType,i=e.originalType,l=e.parentName,h=a(e,["components","mdxType","originalType","parentName"]),p=d(t),m=s,u=p["".concat(l,".").concat(m)]||p[m]||c[m]||i;return t?r.createElement(u,o(o({ref:n},h),{},{components:t})):r.createElement(u,o({ref:n},h))}));h.displayName="MDXCreateElement"}}]);