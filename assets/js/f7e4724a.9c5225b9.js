"use strict";(self.webpackChunkosism=self.webpackChunkosism||[]).push([[5826],{3905:(e,t,n)=>{n.d(t,{Zo:()=>m,kt:()=>k});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},m=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,s=e.parentName,m=l(e,["components","mdxType","originalType","parentName"]),d=p(n),c=o,k=d["".concat(s,".").concat(c)]||d[c]||u[c]||i;return n?a.createElement(k,r(r({ref:t},m),{},{components:n})):a.createElement(k,r({ref:t},m))}));function k(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,r=new Array(i);r[0]=c;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[d]="string"==typeof e?e:o,r[1]=l;for(var p=2;p<i;p++)r[p]=n[p];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},2891:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>r,default:()=>u,frontMatter:()=>i,metadata:()=>l,toc:()=>p});var a=n(7462),o=(n(7294),n(3905));const i={sidebar_label:"Bootstrap",sidebar_position:5},r="Bootstrap",l={unversionedId:"guides/deploy-guide/bootstrap",id:"guides/deploy-guide/bootstrap",title:"Bootstrap",description:"Before the nodes can be bootstrapped, they must all have already been provisioned.",source:"@site/docs/guides/deploy-guide/bootstrap.md",sourceDirName:"guides/deploy-guide",slug:"/guides/deploy-guide/bootstrap",permalink:"/docs/guides/deploy-guide/bootstrap",draft:!1,editUrl:"https://github.com/osism/osism.github.io/tree/main/docs/guides/deploy-guide/bootstrap.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_label:"Bootstrap",sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"Manager",permalink:"/docs/guides/deploy-guide/manager"},next:{title:"Kubernetes",permalink:"/docs/guides/deploy-guide/kubernetes"}},s={},p=[{value:"Provisioning of management and control plane nodes",id:"provisioning-of-management-and-control-plane-nodes",level:2},{value:"Manual provisioning",id:"manual-provisioning",level:3}],m={toc:p},d="wrapper";function u(e){let{components:t,...n}=e;return(0,o.kt)(d,(0,a.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"bootstrap"},"Bootstrap"),(0,o.kt)("p",null,"Before the nodes can be bootstrapped, they must all have already been provisioned.\nThe guide for this can be found in the section\n",(0,o.kt)("a",{parentName:"p",href:"bootstrap#provisioning-of-management-and-control-plane-nodes"},"Provisioning of management and control plane nodes")),(0,o.kt)("p",null,"The following steps are applied to bootstrap all nodes. After the completion of the bootstrap, the nodes are already ready for use."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Create operator user."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"osism apply operator -u osism\n")),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"The operator public SSH key has to be added in advance on all nodes to ",(0,o.kt)("inlineCode",{parentName:"p"},"authorized_keys")," file\nof the user specified with ",(0,o.kt)("inlineCode",{parentName:"p"},"-u"),". This key is stored as ",(0,o.kt)("inlineCode",{parentName:"p"},"operator_public_key")," in the file\n",(0,o.kt)("inlineCode",{parentName:"p"},"environments/configuration.yml"),".")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Alternatively (not recommended), the password can be stored in plain text in a file ",(0,o.kt)("inlineCode",{parentName:"p"},"/opt/configuration/secrets/osism_password"),".\nThe parameter ",(0,o.kt)("inlineCode",{parentName:"p"},"--conn-pass-file /opt/configuration/secrets/osism_password")," must then also be specified:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"osism apply operator -u osism --conn-pass-file /opt/configuration/secrets/osism_password\n"))))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Network configuration. It is recommended to backup the existing network configuration."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"osism apply network\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Reboot (optional). The reboot at this point is recommended to ensure that the network configuration is working."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"osism apply reboot -l 'all:!manager' -e ireallymeanit=yes\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Check if all systems are reachable (you probably have to do this several times until all systems are accessible)."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"osism apply ping\n")),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"System is currently rebooting and is not yet accessible via network."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},'fatal: [net003]: UNREACHABLE! => {"changed": false, "msg": "Connection timed\nout.", "unreachable": true}``\n'))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"System has already been rebooted and is not accessible via the network."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},'fatal: [net003]: UNREACHABLE! => {"changed": false, "msg": "EOF on stream;\nlast 100 lines received:\\nssh: connect to host 10.15.0.33 port 22: No route\nto host\\r", "unreachable": true}\n'))))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Refresh facts."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"osism apply facts\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Bootstrap."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"osism apply bootstrap\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Reboot (non-optional). Since the kernel version often changes after the initial bootstrap,\nthe reboot should always be performed."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"osism apply reboot -l 'all:!manager' -e ireallymeanit=yes\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Prepare the SSH configuration of the manager node."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"osism apply sshconfig\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Check again if all systems are reachable (you probably have to do this several times until all systems are accessible)."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"osism apply ping\n")))),(0,o.kt)("p",null,"Ready. All nodes are now bootstrapped and available to deploy services."),(0,o.kt)("h2",{id:"provisioning-of-management-and-control-plane-nodes"},"Provisioning of management and control plane nodes"),(0,o.kt)("p",null,"For the initial deployment of the management plane and the control plane of OSISM,\nthe nodes must be pre-provisioned with Ubuntu 22.04. Currently, only Ubuntu 22.04 is supported\nby OSISM."),(0,o.kt)("p",null,"Data plane nodes can be automatically provisioned after the initial deployment and\ndo not need to be pre-provisioned."),(0,o.kt)("p",null,"It is recommended not to install the initial nodes of the management plane and the\ncontrol plane manually. An ISO image is provided for this purpose which automatically\nprovisions a node. The ISO images are available for download in the\n",(0,o.kt)("a",{parentName:"p",href:"https://github.com/osism/node-image"},"osism/node-image")," repository."),(0,o.kt)("p",null,"There are different variants of the ISO image. The variants differ in the disc layout.\nThe available variants are described in the README file of the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/osism/node-image"},"osism/node-image"),"\nrepository."),(0,o.kt)("h3",{id:"manual-provisioning"},"Manual provisioning"),(0,o.kt)("p",null,"If none of the provided variants is suitable, this section describes the manual\ninstallation with the help of the Ubuntu 22.04 live ISO image. The manual installation\nis possible without network connectivity."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Download the latest ISO image for Ubuntu 22.04 from ",(0,o.kt)("a",{parentName:"li",href:"https://www.releases.ubuntu.com/22.04/"},"releases.ubuntu.com"),".",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"Use the ",(0,o.kt)("inlineCode",{parentName:"li"},"ubuntu-22.04.1-live-server-amd64.iso")," image."),(0,o.kt)("li",{parentName:"ul"},"The version number may be different, always use the latest available version of 22.04 LTS."))),(0,o.kt)("li",{parentName:"ul"},"Choose ",(0,o.kt)("inlineCode",{parentName:"li"},"English")," as language."),(0,o.kt)("li",{parentName:"ul"},"Choose ",(0,o.kt)("inlineCode",{parentName:"li"},"Install Ubuntu Server"),"."),(0,o.kt)("li",{parentName:"ul"},"Choose ",(0,o.kt)("inlineCode",{parentName:"li"},"English as language")," (again)."),(0,o.kt)("li",{parentName:"ul"},"Choose your location (e.g. ",(0,o.kt)("inlineCode",{parentName:"li"},"Germany"),")."),(0,o.kt)("li",{parentName:"ul"},"Choose ",(0,o.kt)("inlineCode",{parentName:"li"},"en_US.UTF-8")," as locale."),(0,o.kt)("li",{parentName:"ul"},"Choose the keyboard layout from a list, use ",(0,o.kt)("inlineCode",{parentName:"li"},"English (US)"),"."),(0,o.kt)("li",{parentName:"ul"},"Choose and configure the primary network interface.",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"Depending on the environment, the network may not work at this point. Then select any interface\nand then select ",(0,o.kt)("inlineCode",{parentName:"li"},"Do not configure the network at this time")," in the next step."))),(0,o.kt)("li",{parentName:"ul"},"Set the hostname.",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"The hostname is e.g. ",(0,o.kt)("inlineCode",{parentName:"li"},"node")," and not a FQDN like ",(0,o.kt)("inlineCode",{parentName:"li"},"node.systems.osism.xyz"),"."))),(0,o.kt)("li",{parentName:"ul"},"Set ",(0,o.kt)("inlineCode",{parentName:"li"},"osism")," as full name for the new user."),(0,o.kt)("li",{parentName:"ul"},"Set ",(0,o.kt)("inlineCode",{parentName:"li"},"osism")," as the username for the account.",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"The later used operator user ",(0,o.kt)("inlineCode",{parentName:"li"},"dragon")," is created during the bootstrap and ",(0,o.kt)("strong",{parentName:"li"},"should not be created")," during the installation"),(0,o.kt)("li",{parentName:"ul"},"The account is only needed initially and can be deleted after completion of the bootstrap."))),(0,o.kt)("li",{parentName:"ul"},"Set a password for the account."),(0,o.kt)("li",{parentName:"ul"},"Choose ",(0,o.kt)("inlineCode",{parentName:"li"},"Manual")," as partitioning method and execute the partitioning according to company specifications",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"The use of a UEFI is recommended"),(0,o.kt)("li",{parentName:"ul"},"The use of a RAID is recommended. We prefer the use of software RAIDs to make us less dependent on hardware.\nBut there is nothing against using hardware RAIDs."),(0,o.kt)("li",{parentName:"ul"},"The use of a LVM2 is recommended. ",(0,o.kt)("inlineCode",{parentName:"li"},"system")," is recommended as the name for the volume group."),(0,o.kt)("li",{parentName:"ul"},"Dedicated disks may be provided for ",(0,o.kt)("inlineCode",{parentName:"li"},"/var/lib/docker")," on the controller nodes. In this case, do not\nuse an LV for ",(0,o.kt)("inlineCode",{parentName:"li"},"/var/lib/docker")," but the devices provided for it."),(0,o.kt)("li",{parentName:"ul"},"Do not configure devices that are not required for the operating system."),(0,o.kt)("li",{parentName:"ul"},"The use of own file systems for the following mountpoints is recommended. The size of the individual partitions\nis minimal. Depending on the node type, the individual partitions should be made larger. This applies in\nparticular to ",(0,o.kt)("inlineCode",{parentName:"li"},"/var/lib/docker"),". On controllers at least 100 GByte should be used.",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"/")," (10 GByte, logical volume ",(0,o.kt)("inlineCode",{parentName:"li"},"root"),")"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"/home")," (2 GByte, logical volume ",(0,o.kt)("inlineCode",{parentName:"li"},"home"),")"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"/tmp")," (5 GByte, logical volume ",(0,o.kt)("inlineCode",{parentName:"li"},"tmp"),")"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"/var/lib/ceph")," (50 GByte, logical volume ",(0,o.kt)("inlineCode",{parentName:"li"},"ceph"),") (optional for storage nodes)"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"/var/lib/docker")," (30 GByte, logical volume ",(0,o.kt)("inlineCode",{parentName:"li"},"docker"),", do not set the ",(0,o.kt)("inlineCode",{parentName:"li"},"nosuid")," flag on ",(0,o.kt)("inlineCode",{parentName:"li"},"/var/lib/docker"),")",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"When using XFS as the file system for ",(0,o.kt)("inlineCode",{parentName:"li"},"/var/lib/docker"),", note the following: Running on XFS without ",(0,o.kt)("inlineCode",{parentName:"li"},"d_type")," support\ncauses Docker to skip the attempt to use the ",(0,o.kt)("inlineCode",{parentName:"li"},"overlay")," or ",(0,o.kt)("inlineCode",{parentName:"li"},"overlay2")," driver."))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"/var/log/audit")," (1 GByte, logical volume ",(0,o.kt)("inlineCode",{parentName:"li"},"audit"),")"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"/var")," (10 GByte, logical volume ",(0,o.kt)("inlineCode",{parentName:"li"},"var"),")"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"swap")," (min 8 GByte, logical volume ",(0,o.kt)("inlineCode",{parentName:"li"},"swap"),")"))))),(0,o.kt)("li",{parentName:"ul"},"Choose ",(0,o.kt)("inlineCode",{parentName:"li"},"No automatic updates"),"."),(0,o.kt)("li",{parentName:"ul"},"Choose ",(0,o.kt)("inlineCode",{parentName:"li"},"OpenSSH server")," as software to install.",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Do not install any other software component.")," Everything you need will be installed later by OSISM.\nIn particular, it is not necessary to install a desktop environment."))),(0,o.kt)("li",{parentName:"ul"},"After completion, restart the system.")))}u.isMDXComponent=!0}}]);