<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-guides/deploy-guide/examples/cloud-in-a-box" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.0">
<title data-rh="true">Cloud in a Box - CiaB | OSISM</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://your-docusaurus-test-site.com/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://your-docusaurus-test-site.com/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://your-docusaurus-test-site.com/docs/guides/deploy-guide/examples/cloud-in-a-box"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Cloud in a Box - CiaB | OSISM"><meta data-rh="true" name="description" content="ðŸ’¡ Cloud in a Box (CiaB) is a minimalistic installation of the latest stable OSISM release with only services which are needed to"><meta data-rh="true" property="og:description" content="ðŸ’¡ Cloud in a Box (CiaB) is a minimalistic installation of the latest stable OSISM release with only services which are needed to"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://your-docusaurus-test-site.com/docs/guides/deploy-guide/examples/cloud-in-a-box"><link data-rh="true" rel="alternate" href="https://your-docusaurus-test-site.com/docs/guides/deploy-guide/examples/cloud-in-a-box" hreflang="en"><link data-rh="true" rel="alternate" href="https://your-docusaurus-test-site.com/docs/guides/deploy-guide/examples/cloud-in-a-box" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="OSISM RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="OSISM Atom Feed"><link rel="stylesheet" href="/assets/css/styles.9392b5bd.css">
<script src="/assets/js/runtime~main.33675ae8.js" defer="defer"></script>
<script src="/assets/js/main.24aef49b.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="OSISM Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="OSISM Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">OSISM</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro/">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/osism/osism.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/intro/">Introduction</a><button aria-label="Expand sidebar category &#x27;Introduction&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/getting-started">Getting Started</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/guides/">Guides</a><button aria-label="Collapse sidebar category &#x27;Guides&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/guides/deploy-guide/">Deploy Guide</a><button aria-label="Collapse sidebar category &#x27;Deploy Guide&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/deploy-guide/seed">Seed</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/deploy-guide/manager">Manager</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/deploy-guide/provisioning">Provisioning</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/deploy-guide/bootstrap">Bootstrap</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/guides/deploy-guide/services/">Services</a><button aria-label="Expand sidebar category &#x27;Services&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/guides/deploy-guide/examples/">Examples</a><button aria-label="Collapse sidebar category &#x27;Examples&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/guides/deploy-guide/examples/cloud-in-a-box">Cloud in a Box</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/deploy-guide/examples/testbed">Testbed</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/guides/upgrade-guide/">Upgrade Guide</a><button aria-label="Expand sidebar category &#x27;Upgrade Guide&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/guides/configuration-guide/">Configuration Guide</a><button aria-label="Expand sidebar category &#x27;Configuration Guide&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/guides/operations-guide/">Operations Guide</a><button aria-label="Expand sidebar category &#x27;Operations Guide&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/guides/troubleshooting-guide/">Troubleshooting Guide</a><button aria-label="Expand sidebar category &#x27;Troubleshooting Guide&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/guides/other-guides/">Other Guides</a><button aria-label="Expand sidebar category &#x27;Other Guides&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/references/">References</a><button aria-label="Expand sidebar category &#x27;References&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/release-notes/">Release Notes</a><button aria-label="Expand sidebar category &#x27;Release Notes&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/appendix/">Appendix</a><button aria-label="Expand sidebar category &#x27;Appendix&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/guides/"><span itemprop="name">Guides</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/guides/deploy-guide/"><span itemprop="name">Deploy Guide</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/guides/deploy-guide/examples/"><span itemprop="name">Examples</span></a><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Cloud in a Box</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1 id="cloud-in-a-box---ciab">Cloud in a Box - CiaB</h1>
<p>ðŸ’¡ Cloud in a Box (CiaB) is a minimalistic installation of the latest stable OSISM release with only services which are needed to
make it work with Kubernetes. It is intended for use as a development
system on bare-metal or for use in edge environments.</p>
<admonition type="warning"><p>At the moment the secrets are stored in plain text in the <a href="https://github.com/osism/cloud-in-a-box">osism/cloud-in-a-box</a>
repository and are not secure. Do not use for public accessible systems. In the future, the secrets will be generated automatically.</p></admonition>
<h2 id="requirements">Requirements</h2>
<p>The system to be used as Cloud in a Box must fulfill these minimum requirements.</p>
<table><thead><tr><th>Type of resource</th><th>Amount</th><th>Note</th></tr></thead><tbody><tr><td>CPU</td><td>at least 1 socket with 4 cores</td><td>More is better here. This is the minimum where you can&#x27;t use much payload (LBaaS, VMs). The use of Kubernetes with Cluster API is not possible with this minimum size.</td></tr><tr><td>RAM</td><td>at least 32 GByte</td><td>More is better here. In principle, it also works with 8 GByte, but then no payload (LBaaS, VMs) can be used. Kubernetes with Cluster API cannot be used then.</td></tr><tr><td>Storage</td><td>at least 1 TByte</td><td>Has to be available as <code>/dev/sda</code> or <code>/dev/nvme0n1</code>. Less than 1 TByte is also possible, the smaller the less storage is available for use in Ceph.</td></tr><tr><td>Network</td><td>at least 1 network interface (DHCP and internet access)</td><td>An optional <a href="#use-of-2nd-nic-for-external-network">2nd network interface can be used for external connectivity</a>.</td></tr><tr><td>USB stick</td><td>at least 2 GByte</td><td>Installation media for Cloud in a Box bootstrapping</td></tr></tbody></table>
<h2 id="types">Types</h2>
<p>There are two types of Cloud in a Box.</p>
<ol>
<li>
<p>The <strong>sandbox</strong> type is intended for developers and demonstrations. A full OSISM installation
is one there which also includes Ceph and OpenSearch, for example. In the course of the
installation, necessary images, networks, etc. are also created.</p>
</li>
<li>
<p>The <strong>edge</strong> type is intended to be deployed as an appliance to provide an edge cloud on a
single node. Compared to the sandbox, certain services are not provided there or are
implemented differently. For example, OpenSearch is not deployed because the logs are
delivered to a central location. The storage backend will also be implemented differently there
in the future instead of Ceph.</p>
</li>
</ol>
<h2 id="installation">Installation</h2>
<h3 id="automated-installation-recommended">Automated installation (recommended)</h3>
<p>The images currently download and install the
<a href="https://github.com/osism/cloud-in-a-box">latest state of the installation scripts</a>,
therefore it is mandatory to update the installation media at least when the underlying Ubuntu operating
system release changes. The installation of older releases is currently not supported.</p>
<ol>
<li>
<p>Download one of the Cloud in a Box images of type sandbox</p>
<ul>
<li><a href="https://swift.services.a.regiocloud.tech/swift/v1/AUTH_b182637428444b9aa302bb8d5a5a418c/osism-node-image/ubuntu-autoinstall-cloud-in-a-box-1.iso">ubuntu-autoinstall-cloud-in-a-box-1.iso</a> (with first block device as <code>/dev/sda</code>)</li>
<li><a href="https://swift.services.a.regiocloud.tech/swift/v1/AUTH_b182637428444b9aa302bb8d5a5a418c/osism-node-image/ubuntu-autoinstall-cloud-in-a-box-2.iso">ubuntu-autoinstall-cloud-in-a-box-2.iso</a> (with first block device as <code>/dev/nvme0n1</code>)</li>
</ul>
</li>
<li>
<p>Use a tool like <a href="https://etcher.balena.io">balenaEtcher</a> or <code>dd</code> to create a bootable USB stick with the Cloud
in a Box image.</p>
</li>
<li>
<p>Boot from the USB stick. Make sure that the boot from USB is activated in the BIOS.</p>
<admonition type="warning"><p>When booting from this USB stick, all data on the hard disks will be destroyed
without confirmation.</p></admonition>
</li>
<li>
<p>The installation of the operating system (Ubuntu 22.04) will start and take a few minutes. After that the system
will shutdown.</p>
</li>
<li>
<p>The first start of the system</p>
<ul>
<li>Remove the USB storage device
(The USB stick is only needed again if the Cloud in a Box system is to be fully reinstalled.)</li>
<li>Connect the first network interface to an ethernet interface that provides access to the internet via DHCP configuration</li>
<li>Boot the system from the internal hard disk device</li>
</ul>
</li>
<li>
<p>The deployment will start. This takes some time and the system will shutdown when the
deployment is finished. This takes roughly an hour, possibly longer depending on the
hardware and internet connection.</p>
</li>
<li>
<p>Start the system again. System is ready for use, by default DHCP is tried on the first network device.</p>
</li>
<li>
<p>Login via SSH. Use the user <code>dragon</code> with the password <code>password</code>.
(You can obtain the ip address by inspecting the logs of your dhcp server or from the <em>issue text</em> of the virtual consoles of the system)</p>
<pre><code class="language-bash">ssh dragon@IP_FROM_YOUR_SERVER
passwd
</code></pre>
<p><img alt="CiaB Issue Text" src="/assets/images/issue-6cc9ac7387e0589d625dded707510641.png" width="420" height="109"></p>
</li>
</ol>
<h3 id="manual-installation">Manual installation</h3>
<ol>
<li>
<p>Follow the <a href="../provisioning">provisioning guide</a>,
skip the part about disk layout and do it this way:</p>
<p><img alt="Disk layout" src="/assets/images/disk-layout-db64866af60ef6d2c41245db78dd15d1.png" width="1033" height="769"></p>
<ol>
<li>Create a 1 GByte ext4 partition mounted in <code>/boot</code></li>
<li>Create a 8 GByte swap partition</li>
<li>Create a 120 GByte unformatted partition</li>
<li>Use a <code>Create volume group (LVM)</code> to create a volume group called <code>system</code> with the size of
120 GByte on the partition 4 you just created</li>
<li>Create a logical volume by selecting the <code>Free Space</code> option under <code>system</code> LVM. This volume
should be mounted in <code>/</code> and have size of 100 GByte</li>
<li>Create a partition with the size of the rest of the drive&#x27;s space</li>
<li>Create a new LVM volume group on partition 5 called <code>osd-vg</code> (will be used for Ceph)</li>
</ol>
</li>
<li>
<p>After the Ubuntu installation, the system will be rebooted</p>
</li>
<li>
<p>Log into the machine via console to get its IP address and then use SSH to connect to the machine</p>
</li>
<li>
<p>Clone the <a href="https://github.com/osism/cloud-in-a-box">osism/cloud-in-a-box</a> repository into <code>/opt/cloud-in-a-box</code></p>
<pre><code class="language-bash">sudo git clone https://github.com/osism/cloud-in-a-box /opt/cloud-in-a-box
</code></pre>
</li>
<li>
<p>Disable conflicting services from the default Ubuntu installation</p>
<pre><code class="language-bash">sudo /opt/cloud-in-a-box/cleanup.sh
</code></pre>
</li>
<li>
<p>Install upgrades</p>
<pre><code class="language-bash">sudo apt update
sudo apt upgrade
</code></pre>
</li>
<li>
<p>Run the <code>bootstrap.sh</code> script with the required <a href="#types">type</a> (use of <code>sandbox</code> is recommended)</p>
<pre><code class="language-bash">sudo /opt/cloud-in-a-box/bootstrap.sh sandbox
</code></pre>
</li>
<li>
<p>Run the <code>deploy.sh</code> script with the same type as in step 8 to deploy services like Ceph and OpenStack</p>
<pre><code class="language-bash">sudo /opt/cloud-in-a-box/deploy.sh sandbox
</code></pre>
</li>
<li>
<p>Shutdown the system</p>
<pre><code class="language-bash">sudo shutdown -h now
</code></pre>
</li>
<li>
<p>Start the system again. System is ready for use, by default DHCP is tried on the first network device.</p>
</li>
<li>
<p>Login via SSH. Use the user <code>dragon</code> with the password <code>password</code>.
(You can obtain the ip address by inspecting the logs of your dhcp server or from the <em>issue text</em> of the virtual consoles of the system)</p>
<pre><code class="language-bash">ssh dragon@IP_FROM_YOUR_SERVER
passwd
</code></pre>
<p><img alt="CiaB Issue Text" src="/assets/images/issue-6cc9ac7387e0589d625dded707510641.png" width="420" height="109"></p>
</li>
</ol>
<admonition type="info"><p>The scripts are not idempotent yet. In case there is any fail during <code>bootstrap.sh</code> or <code>deploy.sh</code> you have to
start over with fresh installation.</p></admonition>
<h2 id="usage">Usage</h2>
<h3 id="wireguard-vpn-service-access">Wireguard VPN service access</h3>
<p>Copy the <code>/home/dragon/wireguard-client.conf</code> file from Cloud in a Box to your workstation. This is necessary
for using the web endpoints on your workstation. Rename the wireguard config file to something
like <code>cloud-in-a-box.conf</code>.</p>
<p>If you want to connect to the Cloud in a Box system from multiple clients, change the client IP
address in the config file to be different on each client.</p>
<pre><code class="language-bash">scp dragon@IP_FROM_YOUR_SERVER:/home/dragon/wireguard-client.conf $HOME/cloud-in-a-box.conf
</code></pre>
<p>Install wireguard on your workstation, if you have not done this before. For instructions how to do
it on your workstation, please have a look on the documentation of your used distribution. The
wireguard documentation you will find <a href="https://www.wireguard.com/">here</a>.</p>
<p>Start the wireguard tunnel.</p>
<pre><code class="language-bash">sudo wg-quick up $HOME/cloud-in-a-box.conf
</code></pre>
<h3 id="webinterfaces">Webinterfaces</h3>
<p>If you want to access the services please choose the URL from the following list:</p>
<table><thead><tr><th>Name</th><th>URL</th><th>Username</th><th>Password</th></tr></thead><tbody><tr><td>ARA</td><td><a href="https://ara.services.in-a-box.cloud">https://ara.services.in-a-box.cloud</a></td><td>ara</td><td>password</td></tr><tr><td>Ceph</td><td><a href="http://api.in-a-box.cloud:7000">http://api.in-a-box.cloud:7000</a></td><td>admin</td><td>password</td></tr><tr><td>Flower</td><td><a href="https://flower.services.in-a-box.cloud">https://flower.services.in-a-box.cloud</a></td><td>-</td><td>-</td></tr><tr><td>Grafana</td><td><a href="https://api.in-a-box.cloud:3000">https://api.in-a-box.cloud:3000</a></td><td>admin</td><td>password</td></tr><tr><td>HAProxy</td><td><a href="http://manager.systems.in-a-box.cloud:1984">http://manager.systems.in-a-box.cloud:1984</a></td><td>openstack</td><td>password</td></tr><tr><td>Homer</td><td><a href="https://homer.services.in-a-box.cloud">https://homer.services.in-a-box.cloud</a></td><td>-</td><td>-</td></tr><tr><td>Horizon - admin project</td><td><a href="https://api.in-a-box.cloud">https://api.in-a-box.cloud</a></td><td>admin</td><td>password</td></tr><tr><td>Horizon - test project</td><td><a href="https://api.in-a-box.cloud">https://api.in-a-box.cloud</a></td><td>test</td><td>test</td></tr><tr><td>Netbox</td><td><a href="https://netbox.services.in-a-box.cloud">https://netbox.services.in-a-box.cloud</a></td><td>admin</td><td>password</td></tr><tr><td>Netdata</td><td><a href="http://manager.systems.in-a-box.cloud:19999">http://manager.systems.in-a-box.cloud:19999</a></td><td>-</td><td>-</td></tr><tr><td>OpenSearch Dashboards</td><td><a href="https://api.in-a-box.cloud:5601">https://api.in-a-box.cloud:5601</a></td><td>opensearch</td><td>password</td></tr><tr><td>PhpMyAdmin</td><td><a href="https://phpmyadmin.services.in-a-box.cloud">https://phpmyadmin.services.in-a-box.cloud</a></td><td>root</td><td>password</td></tr><tr><td>RabbitMQ</td><td><a href="https://api.in-a-box.cloud:15672">https://api.in-a-box.cloud:15672</a></td><td>openstack</td><td>password</td></tr><tr><td>Skyline - admin project</td><td><a href="https://api.in-a-box.cloud:9999">https://api.in-a-box.cloud:9999</a></td><td>admin</td><td>password</td></tr><tr><td>Skyline - test project</td><td><a href="https://api.in-a-box.cloud:9999">https://api.in-a-box.cloud:9999</a></td><td>test</td><td>test</td></tr></tbody></table>
<h3 id="command-line-interfaces">Command-line interfaces</h3>
<p>Login to Cloud in a Box as described in step 8 of the installation chapter.</p>
<ul>
<li>Select one of the preconfigured environments:<!-- -->
<ul>
<li><code>system</code></li>
<li><code>admin</code></li>
<li><code>test</code></li>
</ul>
</li>
<li>Set the environment by exporting the environment variable: <code>OS_CLOUD</code>:<!-- -->
<pre><code class="language-bash">export OS_CLOUD=admin
</code></pre>
</li>
<li>Use <a href="https://docs.openstack.org/newton/user-guide/cli.html">OpenStack CLI</a> via the command <code>openstack</code>.<!-- -->
<pre><code class="language-bash">openstack availability zone list
openstack image list
openstack server list # After installation there are no servers
</code></pre>
</li>
</ul>
<h3 id="import-of-additional-images">Import of additional images</h3>
<p>The <a href="https://github.com/osism/openstack-image-manager/">OpenStack Image Manager</a> is used to manage images.
In the example, the <code>Garden Linux</code> image is imported.</p>
<pre><code class="language-bash">export OS_CLOUD=admin
osism manage images --filter &#x27;Garden Linux&#x27;
</code></pre>
<p>All available images can be found in the <a href="https://github.com/osism/openstack-image-manager/tree/main/etc/images">osism/openstack-image-manager</a> repository.</p>
<h3 id="upgrade">Upgrade</h3>
<p>It is best to execute the commands within a screen session, it takes some time. Please note
that you cannot update the Ceph deployment at the moment. This will be enabled in the future.</p>
<pre><code class="language-bash">osism apply configuration
/opt/configuration/upgrade.sh
docker system prune -a
</code></pre>
<h2 id="customisations">Customisations</h2>
<h3 id="use-of-2nd-nic-for-external-network">Use of 2nd NIC for external network</h3>
<p>In the default configuration, the Cloud in a Box is built in such a way that an internal
VLAN101 is used as an simulated external network and this is made usable via the 1st network
interface using masquerading. This makes it possible for instances running on the Cloud
in a Box to reach the internet. The disadvantage of this is that the instances themselves
can only be reached via floating IP addresses from the Cloud in a Box system itself or
via the Wireguard tunnel. Especially in edge environments, however, one would usually like
to have this differently and the instances should be directly accessible via the local
network.</p>
<p>To make this work, first identify the name of a 2nd network card to be used.</p>
<pre><code class="language-bash">dragon@manager:~$ sudo lshw -class network -short
H/W path          Device          Class          Description
============================================================
/0/100/2.2/0      eno7            network        Ethernet Connection X552 10 GbE SFP+
/0/100/2.2/0.1    eno8            network        Ethernet Connection X552 10 GbE SFP+
/0/100/1c/0       eno1            network        I210 Gigabit Network Connection
/0/100/1c.1/0     eno2            network        I210 Gigabit Network Connection
/0/100/1c.4/0     eno3            network        I350 Gigabit Network Connection
/0/100/1c.4/0.1   eno4            network        I350 Gigabit Network Connection
/0/100/1c.4/0.2   eno5            network        I350 Gigabit Network Connection
/0/100/1c.4/0.3   eno6            network        I350 Gigabit Network Connection
</code></pre>
<p>In the following we use <code>eno7</code>. Activate the device manually with  <code>sudo ip link set up dev eno7</code>.
Then check that a link is actually present.</p>
<pre><code>dragon@manager:~$ ethtool eno7
Settings for eno7:
	Supported ports: [ FIBRE ]
	Supported link modes:   10000baseT/Full
[...]
	Link detected: yes
</code></pre>
<p>Now this device is made permanently known in the network configuration. Select the MTU
accordingly. For 1 GBit rather <code>1500</code> than <code>9100</code>.</p>
<ul>
<li><code>/opt/configuration/inventory/group_vars/generic/network.yml</code></li>
<li><code>/opt/configuration/environments/manager/group_vars/manager.yml</code></li>
</ul>
<pre><code class="language-yaml">network_ethernets:
  eno1:
    dhcp4: true
  eno7:
    mtu: 9100
</code></pre>
<p>Then, this change is deployed and applied.</p>
<pre><code class="language-bash">osism apply network
sudo netplan apply
</code></pre>
<p>Now the configuration for Neutron and OVN is prepared. <code>network_workload_interface</code>
is expanded by the 2nd network interface. The order is not random, first <code>vlan101</code>
then <code>eno7</code>. <code>neutron_bridge_name</code> is added.</p>
<ul>
<li><code>/opt/configuration/inventory/group_vars/generic/network.yml</code></li>
<li><code>/opt/configuration/environments/manager/group_vars/manager.yml</code></li>
</ul>
<pre><code class="language-yaml">network_workload_interface: &quot;vlan101,eno7&quot;
neutron_bridge_name: &quot;br-ex,br-add&quot;
</code></pre>
<p>Then, this change is deployed.</p>
<pre><code class="language-bash">osism reconciler sync
osism apply openvswitch
osism apply ovn
osism apply neutron
</code></pre>
<p>Now segments and/or subnets can be configured. In this case, <code>eno7</code> is configured as an
untagged port on the remote side.</p>
<ul>
<li><code>/opt/configuration/environments/openstack/playbook-additional-public-network.yml</code></li>
</ul>
<pre><code class="language-yaml">- name: Create additional public network
  hosts: localhost
  connection: local

  tasks:
    - name: Create additional public network
      openstack.cloud.network:
        cloud: admin
        state: present
        name: public-add
        external: true
        provider_network_type: flat
        provider_physical_network: physnet2

    - name: Create additional public subnet
      openstack.cloud.subnet:
        cloud: admin
        state: present
        name: subnet-public-add
        network_name: public-add
        cidr: 192.168.23.0/24
        enable_dhcp: false
        allocation_pool_start: 192.168.23.100
        allocation_pool_end: 192.168.23.200
        gateway_ip: 192.168.23.1
        dns_nameservers:
          - 8.8.8.8
          - 9.9.9.9
</code></pre>
<p>The additional public network can now be made known with
<code>osism apply -e openstack additional-public-network</code>.</p>
<p>There is now a 2nd floating IP address pool with the name <code>public-add</code>
available for use. If instances are to be started directly in this network,
<code>enable_dhcp: true</code> must be set. In this case, it should be clarified in
advance with the provider of the external network whether the use of DHCP
is permitted there.</p>
<h3 id="running-on-a-virtual-machine">Running on a Virtual Machine</h3>
<p>The Cloud in a Box has been tested to run on a virtual machine. However, the Cloud in a Box is mainly made
for running on bare metal, the automated installation does not work, and other things may not work either.</p>
<h4 id="nested-virtualization">Nested virtualization</h4>
<p>You likely want to run virtual machines on top of your Cloud in a Box.
The host machine has to support and enabled nested virtualization.</p>
<p>To enable nested virtualization the CPU configuration of the VM has to be <code>host-passthrough</code> or <code>host-model</code></p>
<ul>
<li><a href="https://docs.fedoraproject.org/en-US/quick-docs/using-nested-virtualization-in-kvm/">Enabling nested virtualization in Fedora</a></li>
</ul>
<p>The linked guide can be used in other distributions as well.</p>
<h4 id="disk-space-saving">Disk space saving</h4>
<p>When using Cloud in a Box in a VM, you can utilize the qcow2 disk image or similar technology to save space.
In that case, the base installation requires just around 70 GB instead of a full 1 TB.
(<em>The drive still needs to be made with a capacity of at least 1TB; however, the actual disk space usage is lower.</em>)</p>
<p>Also in case you want to experiment a bit more and &quot;hack around&quot; using the manual installation
you can make disk snapshots when turned off after the Ubuntu installs, <code>bootstrap.sh</code> and <code>deploy.sh</code> to speed up your
progress.</p>
<p>If you use qemu, you can use following command to do snapshots.</p>
<pre><code class="language-bash">sudo virsh snapshot-create-as --domain cib bootstrap &quot;run of bootstrap.sh&quot; --disk-only --diskspec sda,snapshot=external,file=/var/lib/libvirt/images/ub2022_cib_boostrap.qcow2 --atomic
</code></pre>
<h4 id="qemu-guest-agent">QEMU guest agent</h4>
<p>When running inside QEMU, it may be worth it to install the QEMU guest agent.</p>
<pre><code class="language-bash">sudo apt -y install qemu-guest-agent
sudo systemctl enable qemu-guest-agent
sudo systemctl start qemu-guest-agent
</code></pre>
<h2 id="troubleshooting">Troubleshooting</h2>
<p><img alt="Broken disk setup" src="/assets/images/screenshot1-c880f78ba33fc0577dce811dc2e42724.png" width="2020" height="1194"></p>
<p>This error means that your disk setup is broken. Use <code>cfdisk</code> and delete all partitions on
the system on which you want to install the Cloud in a Box image.</p>
<p>With <code>lsblk</code> you can verify if the partitions are empty.</p>
<h2 id="development">Development</h2>
<p>For the further development of the scripts and the mechanisms of the Cloud in a Box,
you need to know the following.</p>
<ul>
<li>The operating system is brought onto the node via <a href="https://github.com/osism/node-image">an automatic Ubuntu installation</a>
that uses <a href="https://cloud-init.io">cloud-init</a></li>
<li>The installation starts the script <a href="https://github.com/osism/cloud-in-a-box/blob/main/init.sh">init.sh</a> which performs
an initial clone of the <a href="https://github.com/osism/cloud-in-a-box">osism/cloud-in-a-box</a> repository and a checkout of
the <code>main</code> branch. It also executes the <a href="https://github.com/osism/cloud-in-a-box/blob/main/deploy.sh">deploy.sh</a> and
<a href="https://github.com/osism/cloud-in-a-box/blob/main/bootstrap.sh">bootstrap.sh</a> scripts.</li>
<li>The installation persists the kernel parameters of the initial boot to the file <code>/etc/.initial-kernel-commandline</code></li>
<li>The status and activities of the deployment are logged in <code>/var/log/install-cloud-in-a-box.log</code>. For proper colors use <code>less -r</code>.
Search for <code>OVERALL STATUS</code> to find the result of the specific installation steps.</li>
<li>Branch and location of the <a href="https://github.com/osism/cloud-in-a-box">osism/cloud-in-a-box</a> repository can be overriden
by setting the kernel parameters <code>ciab_repo_url</code> (a public repository address without authentication) and <code>ciab_branch</code>
(a name of a branch, use only ASCII chars, <code>-</code>, and <code>_</code>).</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/osism/osism.github.io/tree/main/docs/guides/deploy-guide/examples/cloud-in-a-box.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/guides/deploy-guide/examples/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Examples</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/guides/deploy-guide/examples/testbed"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Testbed</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#requirements" class="table-of-contents__link toc-highlight">Requirements</a></li><li><a href="#types" class="table-of-contents__link toc-highlight">Types</a></li><li><a href="#installation" class="table-of-contents__link toc-highlight">Installation</a><ul><li><a href="#automated-installation-recommended" class="table-of-contents__link toc-highlight">Automated installation (recommended)</a></li><li><a href="#manual-installation" class="table-of-contents__link toc-highlight">Manual installation</a></li></ul></li><li><a href="#usage" class="table-of-contents__link toc-highlight">Usage</a><ul><li><a href="#wireguard-vpn-service-access" class="table-of-contents__link toc-highlight">Wireguard VPN service access</a></li><li><a href="#webinterfaces" class="table-of-contents__link toc-highlight">Webinterfaces</a></li><li><a href="#command-line-interfaces" class="table-of-contents__link toc-highlight">Command-line interfaces</a></li><li><a href="#import-of-additional-images" class="table-of-contents__link toc-highlight">Import of additional images</a></li><li><a href="#upgrade" class="table-of-contents__link toc-highlight">Upgrade</a></li></ul></li><li><a href="#customisations" class="table-of-contents__link toc-highlight">Customisations</a><ul><li><a href="#use-of-2nd-nic-for-external-network" class="table-of-contents__link toc-highlight">Use of 2nd NIC for external network</a></li><li><a href="#running-on-a-virtual-machine" class="table-of-contents__link toc-highlight">Running on a Virtual Machine</a></li></ul></li><li><a href="#troubleshooting" class="table-of-contents__link toc-highlight">Troubleshooting</a></li><li><a href="#development" class="table-of-contents__link toc-highlight">Development</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/osism" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2023 OSISM GmbH. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>